<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="boardDAO">
	<select id="listcount" resultType="boardVO">
			select count(*) from "BOARD2"
	</select>
	
	<select id="list" resultType="boardVO" parameterType="int">
			SELECT * FROM
			<![CDATA[(select rownum RNUM, NUM, UPLOADER
			EMAIL,SUBJECT,PASS,REGDATE,FILENAME,
			READCOUNT,REF,STEP,DEPTH,CONTENT,IP from
			(select*from BOARD2 order by REF desc, STEP asc))
			where RNUM >=#{strat} and RNUM <=#{end}]]>
	</select>
	
	<insert id="reply" parameterType="boardVO">
		update BOARD2 set STEP = STEP+1 where REF = #{REF} and STEP > #{STEP}
		<selectKey keyProperty="num" resultType="Integer">
			select max(NUM) from BOARD2
		</selectKey>
	</insert>
	
	<insert id="insert" parameterType="boardVO">
		insert into BOARD2
		(NUM, UPLOADER, EMAIL, SUBJECT, PASS, REGDATE, FILENMAE, REF, STEP, DEPTH, CONTENT, IP)
		values(BOARD2_SEQ,nextval, #{NUM}, #{UPLOADER}, #{EMAIL}, #{SUBJECT}, #{PASS}, #{REGDATE},)
		#{FILENAME}, #{REF}, #{STEP}, #{DEPTH}, #{CONTENT}, #{IP})
		<selectKey keyProperty="num" resultType="Integer">
			select max(NUM) from BOARD2
		</selectKey>
	</insert>
	
	<update id="content" parameterType="boardVO">
		update BOARD2 set READCOUNT=READCOUNT+1 where NUM = #{NUM}
	</update>
	
	<select id="content" parameterType="boardVO">
		select * from BOARD2 where NUM = #{NUM}
	</select>
</mapper>